@* ==========================================================================
   VerneMQ Dashboard - Monitoring Tab Partial View
   Simplified control center view for essential system health and metrics
   ========================================================================== *@

<!-- Critical Alerts Container (dynamically populated) -->
<div id="criticalAlertsContainer"></div>

<!-- Section: System Health Overview -->
<div class="monitoring-section">
    <div class="monitoring-section-title">
        <i class="fas fa-heart-pulse"></i> System Health
    </div>
    
    <div class="row g-3">
        <!-- VerneMQ Broker Status -->
        <div class="col-6 col-lg-3">
            <div class="status-card">
                <div class="status-card-label">
                    <i class="fas fa-server"></i> VerneMQ Broker
                </div>
                <div id="vernemqStatusCard" class="d-flex align-items-center gap-2 mt-2">
                    <span class="status-dot online pulsing" id="vernemqDot"></span>
                    <span class="status-card-value text-success">Online</span>
                </div>
            </div>
        </div>
        
        <!-- Webhook API Status -->
        <div class="col-6 col-lg-3">
            <div class="status-card">
                <div class="status-card-label">
                    <i class="fas fa-link"></i> Webhook API
                </div>
                <div id="webhookStatusCard" class="d-flex align-items-center gap-2 mt-2">
                    <span class="status-dot online pulsing" id="webhookDot"></span>
                    <span class="status-card-value text-success">Online</span>
                </div>
                <div class="status-card-meta" id="webhookLatency">Latency: --</div>
            </div>
        </div>
        
        <!-- System Uptime -->
        <div class="col-6 col-lg-3">
            <div class="status-card">
                <div class="status-card-label">
                    <i class="fas fa-clock"></i> System Uptime
                </div>
                <div class="status-card-value mt-2" id="systemUptime">-</div>
                <div class="status-card-meta" id="lastRefresh">Last check: --</div>
            </div>
        </div>
        
        <!-- Webhook Health Score -->
        <div class="col-6 col-lg-3">
            <div class="status-card d-flex align-items-center gap-3">
                <div class="health-ring">
                    <svg width="88" height="88" viewBox="0 0 88 88">
                        <circle class="health-ring-bg" cx="44" cy="44" r="38"></circle>
                        <circle class="health-ring-progress" cx="44" cy="44" r="38" 
                            stroke-dasharray="239" stroke-dashoffset="239" id="healthScoreProgress"></circle>
                    </svg>
                    <div class="health-ring-content">
                        <span class="health-ring-value" id="healthScoreValue">--%</span>
                        <span class="health-ring-label">Health</span>
                    </div>
                </div>
                <div>
                    <div class="small fw-semibold text-secondary">Success Rate</div>
                    <div class="small text-muted" id="healthScoreDetails">Loading...</div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Section: Key Metrics -->
<div class="monitoring-section">
    <div class="monitoring-section-title">
        <i class="fas fa-chart-simple"></i> Key Metrics
    </div>
    
    <div class="row g-3">
        <!-- Active Connections -->
        <div class="col-6 col-lg-3">
            <div class="metric-card accent-left accent-info" id="connectionsCard">
                <i class="fas fa-wifi metric-card-icon"></i>
                <div class="metric-label">
                    <i class="fas fa-wifi text-info"></i> Active Connections
                </div>
                <div class="d-flex align-items-baseline gap-2">
                    <span class="metric-value" id="mqttConnections">-</span>
                    <span class="metric-trend neutral" id="connectionsTrend">
                        <i class="fas fa-minus"></i> --
                    </span>
                </div>
            </div>
        </div>
        
        <!-- Messages/min -->
        <div class="col-6 col-lg-3">
            <div class="metric-card accent-left accent-success" id="messagesCard">
                <i class="fas fa-envelope metric-card-icon"></i>
                <div class="metric-label">
                    <i class="fas fa-envelope text-success"></i> Messages/min
                </div>
                <div class="d-flex align-items-baseline gap-2">
                    <span class="metric-value" id="mqttMessages">-</span>
                    <span class="metric-trend neutral" id="messagesTrend">
                        <i class="fas fa-minus"></i> --
                    </span>
                </div>
            </div>
        </div>
        
        <!-- Subscriptions -->
        <div class="col-6 col-lg-3">
            <div class="metric-card accent-left accent-warning" id="subscriptionsCard">
                <i class="fas fa-rss metric-card-icon"></i>
                <div class="metric-label">
                    <i class="fas fa-rss text-warning"></i> Subscriptions
                </div>
                <div class="metric-value" id="mqttSubscriptions">-</div>
            </div>
        </div>
        
        <!-- Errors (24h) -->
        <div class="col-6 col-lg-3">
            <div class="metric-card accent-left accent-danger" id="errorsCard">
                <i class="fas fa-triangle-exclamation metric-card-icon"></i>
                <div class="metric-label">
                    <i class="fas fa-triangle-exclamation text-danger"></i> Errors (24h)
                </div>
                <div class="d-flex align-items-baseline gap-2">
                    <span class="metric-value" id="errorCount24h">0</span>
                    <span class="metric-trend neutral" id="errorsTrend">
                        <i class="fas fa-minus"></i> --
                    </span>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Main Content Grid -->
<div class="row g-4">
    <!-- Left Column: Charts & Throughput -->
    <div class="col-lg-8">
        <!-- Live Activity Panel -->
        <div class="panel mb-4">
            <div class="panel-header">
                <h6 class="panel-title">
                    <i class="fas fa-chart-area"></i>
                    Live Activity
                    <span class="badge badge-neutral ms-2" id="liveActivityBadge">
                        <i class="fas fa-circle text-success" style="font-size: 8px;"></i> Real-time
                    </span>
                </h6>
                <div class="d-flex gap-2">
                    <a href="http://localhost:3030/d/vernemq-mqtt/vernemq-mqtt-broker" target="_blank" 
                        class="btn btn-sm btn-outline" title="Open Full Grafana Dashboard">
                        <i class="fas fa-external-link-alt me-1"></i> Full Dashboard
                    </a>
                </div>
            </div>
            <div class="panel-body p-0">
                <!-- Embedded Grafana Chart - Live Activity Overview (Panel ID 9) -->
                <div class="grafana-embed-container" style="position: relative; height: 400px; background: var(--color-bg-secondary); border-radius: 0 0 var(--radius-lg) var(--radius-lg); overflow: hidden;">
                    <iframe 
                        src="http://localhost:3030/d-solo/vernemq-mqtt/vernemq-mqtt-broker?orgId=1&panelId=9&refresh=5s&from=now-15m&to=now&theme=dark&kiosk"
                        style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none;"
                        loading="lazy"
                        title="Live Activity Chart">
                    </iframe>
                    <!-- Fallback message if Grafana is not available -->
                    <div class="grafana-fallback d-none" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; color: var(--color-text-secondary);">
                        <i class="fas fa-chart-line fa-3x mb-3" style="opacity: 0.3;"></i>
                        <p class="mb-2">Grafana chart unavailable</p>
                        <a href="http://localhost:3030" target="_blank" class="btn btn-sm btn-primary">
                            Open Grafana
                        </a>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Message Throughput Panel -->
        <div class="panel">
            <div class="panel-header">
                <h6 class="panel-title">
                    <i class="fas fa-arrow-right-arrow-left"></i>
                    Message Throughput (Lifetime)
                </h6>
            </div>
            <div class="panel-body">
                <div class="row g-3">
                    <div class="col-6">
                        <div class="p-3 bg-success-subtle rounded-3">
                            <div class="metric-label">
                                <i class="fas fa-arrow-down text-success"></i> Total Received
                            </div>
                            <div class="metric-value" id="publishRate">-</div>
                            <div class="small text-muted mt-1" id="publishRateBytes">-- bytes</div>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="p-3 bg-info-subtle rounded-3" style="background: var(--color-info-bg);">
                            <div class="metric-label">
                                <i class="fas fa-arrow-up text-info"></i> Total Sent
                            </div>
                            <div class="metric-value" id="subscribeRate">-</div>
                            <div class="small text-muted mt-1" id="subscribeRateBytes">-- bytes</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Right Column: Errors & Quick Links -->
    <div class="col-lg-4">
        <!-- Recent Errors Panel -->
        <div class="panel mb-4">
            <div class="panel-header">
                <h6 class="panel-title">
                    <i class="fas fa-circle-exclamation text-danger"></i>
                    Recent Errors
                </h6>
                <span class="badge badge-neutral" id="errorBadge">0</span>
            </div>
            <div class="panel-body">
                <div id="recentErrorsList" class="error-list">
                    <div class="empty-state" style="padding: 1rem;">
                        <i class="fas fa-check-circle text-success"></i>
                        <span class="ms-2">No recent errors</span>
                    </div>
                </div>
            </div>
            <div class="panel-footer">
                <button class="btn btn-sm btn-outline w-100" 
                    onclick="document.querySelector('[data-bs-target=&quot;#logs&quot;]').click()">
                    <i class="fas fa-list me-1"></i> View All Logs
                </button>
            </div>
        </div>
        
        <!-- Quick Links Panel -->
        <div class="panel">
            <div class="panel-header">
                <h6 class="panel-title">
                    <i class="fas fa-external-link"></i>
                    External Tools
                </h6>
            </div>
            <div class="panel-body">
                <div class="action-grid">
                    <a href="http://localhost:9090" target="_blank" class="action-btn">
                        <i class="fas fa-database"></i> Prometheus
                    </a>
                    <a href="http://localhost:3030" target="_blank" class="action-btn">
                        <i class="fas fa-chart-line"></i> Grafana Dashboard
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Hidden elements for JS compatibility -->
<div style="display: none;">
    <span id="mqttSubscriptions">0</span>
    <span id="activeSessionsCount">0</span>
    <span id="failedAuthCount">0</span>
    <span id="signalAuthDetails"></span>
    <span id="signalWebhooksDetails"></span>
    <span id="signalLatencyDetails"></span>
    <span id="signalQueueDetails"></span>
</div>
